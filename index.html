
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="theme-color" content="#38b2ac" />
    <title>ë‚´ì¼ì˜ ë‚˜ì—ê²Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
      body {
        font-family: 'Noto Sans KR', sans-serif;
        -webkit-tap-highlight-color: transparent;
        overflow: hidden;
        background-color: #f8fbfb;
        height: 100dvh;
      }
      .custom-card {
        background: white;
        border: 1px solid #edf2f2;
        border-radius: 2rem;
        box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.05);
      }
      .unified-round {
        border-radius: 2rem;
      }
      .safe-area-inset-bottom {
        padding-bottom: env(safe-area-inset-bottom);
      }
      ::-webkit-scrollbar {
        display: none;
      }
      input, textarea, select, button {
        outline: none !important;
      }
      .tab-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        height: calc(75px + env(safe-area-inset-bottom));
        display: flex;
        justify-content: space-around;
        align-items: center;
        border-top: 1px solid #f0f4f4;
        padding-bottom: env(safe-area-inset-bottom);
        z-index: 50;
      }
      #root {
        height: 100%;
      }
    </style>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<link rel="stylesheet" href="/index.css">
</head>
  <body class="h-[100dvh]">
    <div id="root"></div>
    <script type="text/babel">

const MESSAGE_PROMPTS = [
  "ë‚´ì¼ì˜ ë„ˆëŠ” ë¬´ì—‡ì„ í•˜ê³  ìˆì„ê¹Œ? ê¶ê¸ˆí•˜ë„¤",
  "ì˜¤ëŠ˜ ìˆì—ˆë˜ ì¼ ì¤‘ ê¸°ì–µí•˜ê³  ì‹¶ì€ ê²ƒì€?",
  "ë‚´ì¼ì˜ ëª©í‘œë¥¼ ì‘ì›í•´ ë³´ì„¸ìš”!",
  "ì˜¤ëŠ˜ì˜ ë„ˆì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ì¹­ì°¬ì€?",
  "ë‚´ì¼ì€ ë” ì¢‹ì€ í•˜ë£¨ê°€ ë ê±°ì•¼!",
  "ì˜¤ëŠ˜ ë„ˆ ì •ë§ ê³ ìƒ ë§ì•˜ì–´.",
];

const BOARD_MESSAGES = [
    { id: 1, user: "ìµëª…1", text: "ì˜¤ëŠ˜ë„ ë‹¹ì‹ ì€ ì¶©ë¶„íˆ ì˜ í•´ëƒˆì–´ìš”. ë‚´ì¼ì€ ë” í¸ì•ˆí•œ í•˜ë£¨ê°€ ë˜ê¸¸.", date: "2ì‹œê°„ ì „" },
    { id: 2, user: "ìµëª…2", text: "ì‹¤ìˆ˜í•´ë„ ê´œì°®ì•„ìš”. ë‚´ì¼ì€ ë˜ ë‹¤ë¥¸ ê¸°íšŒê°€ ì°¾ì•„ì˜¬ í…Œë‹ˆê¹Œìš”.", date: "4ì‹œê°„ ì „" },
    { id: 3, user: "ìµëª…3", text: "ë‚˜ ìì‹ ì„ ì¢€ ë” ì‚¬ë‘í•´ì£¼ëŠ” ì—°ìŠµì„ í•˜ê³  ìˆì–´ìš”. ì—¬ëŸ¬ë¶„ë„ í˜ë‚´ì„¸ìš”!", date: "ì–´ì œ" },
    { id: 4, user: "ìµëª…4", text: "ë”°ëœ»í•œ ì»¤í”¼ í•œ ì”ì— í–‰ë³µì„ ëŠë¼ëŠ” ì†Œë°•í•œ ë‚´ì¼ì´ ë˜ê¸°ë¥¼.", date: "ì–´ì œ" },
    { id: 5, user: "ìµëª…5", text: "í˜ë“  ì¼ì€ ì˜¤ëŠ˜ë¡œ ë‹¤ í„¸ì–´ë²„ë ¤ìš”.", date: "ì–´ì œ" },
    { id: 6, user: "ìµëª…6", text: "ì›ƒëŠ” ì–¼êµ´ë¡œ ë‚´ì¼ì„ ë§ì´í•˜ê¸°ë¥¼.", date: "2ì¼ ì „" },
];

const DEFAULT_PROFILE_IMAGE = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23cbd5e1' viewBox='0 0 24 24'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E";

const formatDate = (date) => {
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
};

const formatDateForDisplay = (date) => {
    const year = String(date.getFullYear()).slice(-2);
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}.${month}.${day}`;
};

const Toast = ({ message, isVisible }) => (
    <div className={`fixed top-12 left-1/2 -translate-x-1/2 z-[100] transition-all duration-500 transform ${isVisible ? 'translate-y-0 opacity-100' : '-translate-y-12 opacity-0'}`}>
        <div className="bg-white px-6 py-3 rounded-full shadow-2xl border border-teal-50 flex items-center space-x-3">
            <span className="text-teal-500 text-xl">âœ¨</span>
            <p className="text-gray-800 font-medium text-sm">{message}</p>
        </div>
    </div>
);

function AuthScreen({ onLoginSuccess }) {
    const [isSignUp, setIsSignUp] = React.useState(false);
    const [email, setEmail] = React.useState('');
    const [password, setPassword] = React.useState('');
    const [error, setError] = React.useState('');

    const handleSubmit = () => {
        if (!email || !password) {
            setError('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }

        const storedUsers = JSON.parse(localStorage.getItem('users') || '[]');

        if (isSignUp) {
            if (storedUsers.some(u => u.email === email)) {
                setError('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.');
                return;
            }
            const newUser = { id: Date.now().toString(), email, password };
            localStorage.setItem('users', JSON.stringify([...storedUsers, newUser]));
            alert('íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë¡œê·¸ì¸ì„ í•´ì£¼ì„¸ìš”.');
            setIsSignUp(false);
            setError('');
        } else {
            const user = storedUsers.find(u => u.email === email && u.password === password);
            if (user) {
                onLoginSuccess(user);
            } else {
                setError('ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }
        }
    };

    return (
        <div className="flex flex-col h-full w-full max-w-md mx-auto px-8 justify-center animate-in fade-in duration-700">
            <div className="text-center mb-10">
                <div className="w-16 h-16 bg-teal-500 rounded-[1.5rem] mx-auto mb-4 flex items-center justify-center shadow-xl shadow-teal-100">
                    <span className="text-3xl">âœ‰ï¸</span>
                </div>
                <h1 className="text-2xl font-bold text-gray-800 mb-1">ë‚´ì¼ì˜ ë‚˜ì—ê²Œ</h1>
                <p className="text-gray-500 text-sm">{isSignUp ? 'ìƒˆë¡œìš´ ì—¬ì •ì„ ì‹œì‘í•´ë³´ì„¸ìš”' : 'ë‹¹ì‹ ì˜ ë‚´ì¼ì„ ì‘ì›í•˜ëŠ” í¸ì§€'}</p>
            </div>
            
            <div className="space-y-4">
                <div className="space-y-1">
                    <input
                        type="email"
                        placeholder="ì´ë©”ì¼ ì£¼ì†Œ"
                        value={email}
                        onChange={(e) => {setEmail(e.target.value); setError('');}}
                        className="w-full bg-white border border-gray-200 py-4 px-6 unified-round text-base text-gray-800 placeholder-gray-400 focus:border-teal-400 focus:ring-1 focus:ring-teal-400 transition-all shadow-sm"
                    />
                </div>
                <div className="space-y-1">
                    <input
                        type="password"
                        placeholder="ë¹„ë°€ë²ˆí˜¸"
                        value={password}
                        onChange={(e) => {setPassword(e.target.value); setError('');}}
                        className="w-full bg-white border border-gray-200 py-4 px-6 unified-round text-base text-gray-800 placeholder-gray-400 focus:border-teal-400 focus:ring-1 focus:ring-teal-400 transition-all shadow-sm"
                    />
                </div>
                {error && <p className="text-red-500 text-xs font-medium px-2 animate-pulse">{error}</p>}
                <button
                    onClick={handleSubmit}
                    className="w-full bg-teal-500 text-white py-4 unified-round text-lg font-bold shadow-lg shadow-teal-50 active:scale-[0.98] transition-all mt-2"
                >
                    {isSignUp ? 'ê°€ì…í•˜ê¸°' : 'ì‹œì‘í•˜ê¸°'}
                </button>
            </div>
            
            <div className="mt-8 text-center">
                <button 
                    onClick={() => {setIsSignUp(!isSignUp); setError('');}}
                    className="text-gray-400 text-sm font-medium"
                >
                    {isSignUp ? 'ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”?' : 'ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?'} <span className="text-teal-500 font-bold underline underline-offset-4">{isSignUp ? 'ë¡œê·¸ì¸' : 'íšŒì›ê°€ì…'}</span>
                </button>
            </div>
        </div>
    );
}

function BoardTab() {
    return (
        <div className="flex flex-col h-full animate-in fade-in slide-in-from-bottom-4 duration-500">
            <header className="pt-8 pb-4 px-2">
                <h1 className="text-2xl font-bold text-gray-800">ëª¨ë‘ì˜ ë©”ì‹œì§€</h1>
                <p className="text-gray-400 text-sm">ë‹¤ë¥¸ ì‚¬ëŒë“¤ì€ ì–´ë–¤ ë‚´ì¼ì„ ê¿ˆê¿€ê¹Œìš”?</p>
            </header>
            
            <div className="flex-1 overflow-y-auto space-y-4 pb-24 pr-1">
                {BOARD_MESSAGES.map(msg => (
                    <div key={msg.id} className="custom-card p-5 relative">
                        <div className="flex justify-between items-center mb-3">
                            <span className="text-teal-600 font-bold text-xs bg-teal-50 px-3 py-1 rounded-full">{msg.user}</span>
                            <span className="text-gray-300 text-[10px]">{msg.date}</span>
                        </div>
                        <p className="text-gray-700 leading-relaxed font-medium text-sm">"{msg.text}"</p>
                    </div>
                ))}
            </div>
        </div>
    );
}

function LetterTab({ 
    currentDate, setCurrentDate, isToday, messageFromYesterday, prompt, 
    messageToSend, setMessageToSend, setIsTimePickerOpen, notificationTime, handleSaveMessage, isSaved 
}) {
    return (
        <div className="flex flex-col h-full animate-in fade-in slide-in-from-bottom-4 duration-500 pb-20">
            <header className="flex items-center justify-between w-full pt-8 mb-4">
                <h1 className="text-2xl font-bold text-gray-800 tracking-tight">ë‚˜ì˜ í¸ì§€í•¨</h1>
            </header>

            <div className="flex items-center justify-between mb-4 custom-card p-1">
                <button onClick={() => setCurrentDate(new Date(currentDate.setDate(currentDate.getDate()-1)))} className="p-2 text-gray-400 active:text-teal-500 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2.5}><path strokeLinecap="round" strokeLinejoin="round" d="M15 19l-7-7 7-7" /></svg>
                </button>
                <div className="text-gray-800 font-bold text-base">{formatDateForDisplay(currentDate)}</div>
                <button 
                    onClick={() => setCurrentDate(new Date(currentDate.setDate(currentDate.getDate()+1)))}
                    disabled={isToday}
                    className={`p-2 transition-colors ${isToday ? 'opacity-20' : 'text-gray-400 active:text-teal-500'}`}
                >
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2.5}><path strokeLinecap="round" strokeLinejoin="round" d="M9 5l7 7-7 7" /></svg>
                </button>
            </div>

            <main className="flex-1 flex flex-col space-y-4 overflow-hidden">
                <section>
                    <h2 className="text-[10px] font-bold text-gray-400 mb-2 px-1 uppercase tracking-widest">ì–´ì œì˜ ë‚˜ë¡œë¶€í„°</h2>
                    <div className="custom-card p-6 min-h-[100px] flex items-center justify-center relative overflow-hidden bg-teal-50/30">
                        <p className="text-base text-center font-medium leading-relaxed text-gray-600 italic">
                            "{messageFromYesterday || prompt}"
                        </p>
                    </div>
                </section>

                <section className="flex-1 flex flex-col min-h-0">
                    <div className="flex justify-between items-center mb-2 px-1">
                        <h2 className="text-[10px] font-bold text-gray-400 uppercase tracking-widest">ë‚´ì¼ì˜ ë‚˜ì—ê²Œ</h2>
                        {isSaved && <span className="text-[10px] font-bold text-teal-500 animate-pulse">âœ“ ë¶€ì¹˜ê¸° ì™„ë£Œ</span>}
                    </div>
                    <div className={`custom-card p-1 flex-1 flex flex-col overflow-hidden transition-colors ${isSaved ? 'bg-gray-50' : 'bg-white'}`}>
                        <textarea
                            value={messageToSend}
                            onChange={(e) => setMessageToSend(e.target.value)}
                            readOnly={isSaved}
                            placeholder="ë‚´ì¼ì˜ ë„ˆì—ê²Œ í•˜ê³  ì‹¶ì€ ë§..."
                            className={`w-full flex-1 bg-transparent p-6 text-base text-center placeholder-gray-300 border-0 focus:ring-0 resize-none font-medium transition-all ${isSaved ? 'text-gray-400' : 'text-gray-800'}`}
                        />
                         <button
                            onClick={() => !isSaved && setIsTimePickerOpen(true)}
                            disabled={isSaved}
                            className={`mx-3 mb-3 unified-round py-2.5 text-xs font-semibold flex items-center justify-center space-x-2 border ${isSaved ? 'bg-gray-100 text-gray-300 border-transparent cursor-default' : 'bg-gray-50 text-gray-500 active:bg-gray-100 border-gray-100 transition-colors'}`}
                        >
                            <span>â°</span>
                            <span>{String(notificationTime.hour).padStart(2, '0')}:{String(notificationTime.minute).padStart(2, '0')} ì „ì†¡ ì˜ˆì•½</span>
                        </button>
                    </div>
                </section>
                
                <div className="flex flex-col items-center space-y-2 mb-4">
                    <button
                        onClick={handleSaveMessage}
                        disabled={isSaved || !messageToSend.trim()}
                        className={`w-full unified-round py-4 text-lg font-bold shadow-lg transition-all active:scale-[0.98] ${isSaved ? 'bg-gray-200 text-gray-400 shadow-none cursor-not-allowed' : 'bg-teal-500 text-white shadow-teal-50 hover:bg-teal-600 disabled:opacity-30'}`}
                    >
                        {isSaved ? 'í¸ì§€ ë¶€ì¹˜ê¸° ì™„ë£Œ' : 'í¸ì§€ ì €ì¥í•˜ê¸°'}
                    </button>
                    {isSaved && (
                        <p className="text-[11px] text-gray-400 font-medium">
                            ë‚´ì¼ <span className="text-teal-500 font-bold">{String(notificationTime.hour).padStart(2, '0')}ì‹œ {String(notificationTime.minute).padStart(2, '0')}ë¶„</span>ì— ë³´ë‚´ë“œë¦´ê²Œìš”
                        </p>
                    )}
                </div>
            </main>
        </div>
    );
}

function ProfileTab({ profile, setProfile, onLogout, messagesCount, userEmail }) {
    const fileInputRef = React.useRef(null);
    const handleImageChange = (event) => {
        if (event.target.files && event.target.files[0]) {
            const reader = new FileReader();
            reader.onload = (e) => setProfile({ imageUrl: e.target?.result });
            reader.readAsDataURL(event.target.files[0]);
        }
    };

    return (
        <div className="flex flex-col h-full animate-in fade-in slide-in-from-bottom-4 duration-500 pb-20">
             <header className="pt-8 mb-6 flex justify-between items-center px-2">
                <h1 className="text-2xl font-bold text-gray-800">ë§ˆì´ í˜ì´ì§€</h1>
                <button onClick={onLogout} className="text-gray-400 font-bold text-sm hover:text-red-400 transition-colors">ë¡œê·¸ì•„ì›ƒ</button>
            </header>

            <div className="flex flex-col items-center mb-6">
                <div className="relative mb-4">
                    <div className="w-24 h-24 rounded-full overflow-hidden border-4 border-white shadow-md bg-gray-50 flex items-center justify-center">
                        <img
                            src={profile.imageUrl || DEFAULT_PROFILE_IMAGE}
                            alt="Profile"
                            className={`w-full h-full object-cover ${!profile.imageUrl ? 'scale-75 opacity-30' : ''}`}
                        />
                    </div>
                    <button 
                        onClick={() => fileInputRef.current?.click()}
                        className="absolute bottom-0 right-0 bg-teal-500 text-white p-2 rounded-full shadow-lg border-2 border-white active:scale-90 transition-transform"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
                    </button>
                    <input type="file" accept="image/*" ref={fileInputRef} onChange={handleImageChange} className="hidden" />
                </div>
                <h2 className="text-lg font-bold text-gray-800">{userEmail.split('@')[0]}ë‹˜</h2>
                <p className="text-gray-400 text-xs mt-1">{userEmail}</p>
            </div>

            <div className="grid grid-cols-2 gap-3 mb-6">
                <div className="custom-card p-5 text-center">
                    <p className="text-[10px] font-bold text-gray-400 mb-1 uppercase tracking-widest">ë³´ë‚¸ í¸ì§€</p>
                    <p className="text-xl font-bold text-teal-600">{messagesCount}ê°œ</p>
                </div>
                <div className="custom-card p-5 text-center">
                    <p className="text-[10px] font-bold text-gray-400 mb-1 uppercase tracking-widest">ì—°ì† ì¼ìˆ˜</p>
                    <p className="text-xl font-bold text-teal-600">3ì¼</p>
                </div>
            </div>

            <div className="flex-1 space-y-3 min-h-0 overflow-hidden">
                <button className="w-full bg-white border border-gray-100 unified-round py-4 flex items-center justify-between px-6 text-gray-600 font-semibold active:bg-gray-50 transition-colors shadow-sm text-sm">
                    <span className="flex items-center space-x-3"><span>ğŸ””</span> <span>ì•Œë¦¼ ì„¤ì •</span></span>
                    <span className="text-gray-300">â¯</span>
                </button>
                <button className="w-full bg-white border border-gray-100 unified-round py-4 flex items-center justify-between px-6 text-gray-600 font-semibold active:bg-gray-50 transition-colors shadow-sm text-sm">
                    <span className="flex items-center space-x-3"><span>ğŸ’</span> <span>í”„ë¦¬ë¯¸ì—„ í˜œíƒ</span></span>
                    <span className="text-gray-300">â¯</span>
                </button>
                <button className="w-full bg-white border border-gray-100 unified-round py-4 flex items-center justify-between px-6 text-gray-600 font-semibold active:bg-gray-50 transition-colors shadow-sm text-sm">
                    <span className="flex items-center space-x-3"><span>ğŸ“œ</span> <span>ê³µì§€ì‚¬í•­</span></span>
                    <span className="text-gray-300">â¯</span>
                </button>
            </div>
        </div>
    );
}

function App() {
    const { useState, useEffect, useCallback } = React;
    
    const [currentUser, setCurrentUser] = useState(null);
    const [activeTab, setActiveTab] = useState('letter');
    
    const [currentDate, setCurrentDate] = useState(new Date());
    const [messages, setMessages] = useState({});
    const [profile, setProfile] = useState({ imageUrl: null });
    const [notificationTime, setNotificationTime] = useState({ hour: 8, minute: 0 });
    const [isTimePickerOpen, setIsTimePickerOpen] = useState(false);
    const [prompt, setPrompt] = useState('');
    const [messageToSend, setMessageToSend] = useState('');
    const [toast, setToast] = useState({ isVisible: false, message: '' });

    const showToast = (msg) => {
        setToast({ isVisible: true, message: msg });
        setTimeout(() => setToast({ isVisible: false, message: '' }), 3000);
    };

    useEffect(() => {
        const savedSession = localStorage.getItem('currentUser');
        if (savedSession) setCurrentUser(JSON.parse(savedSession));
        setPrompt(MESSAGE_PROMPTS[Math.floor(Math.random() * MESSAGE_PROMPTS.length)]);
    }, []);

    useEffect(() => {
        if (!currentUser) return;
        
        try {
            const userKey = currentUser.id;
            const storedMessages = localStorage.getItem(`messages_${userKey}`);
            if (storedMessages) setMessages(JSON.parse(storedMessages));
            else setMessages({});

            const storedProfile = localStorage.getItem(`profile_${userKey}`);
            if (storedProfile) setProfile(JSON.parse(storedProfile));
            else setProfile({ imageUrl: null });

            const storedTime = localStorage.getItem(`time_${userKey}`);
            if (storedTime) setNotificationTime(JSON.parse(storedTime));
            else setNotificationTime({ hour: 8, minute: 0 });
        } catch (error) { console.error(error); }
    }, [currentUser]);

    useEffect(() => {
        if (!currentUser) return;
        localStorage.setItem(`messages_${currentUser.id}`, JSON.stringify(messages));
    }, [messages, currentUser]);

    useEffect(() => {
        if (!currentUser) return;
        localStorage.setItem(`profile_${currentUser.id}`, JSON.stringify(profile));
    }, [profile, currentUser]);

    useEffect(() => {
        if (!currentUser) return;
        localStorage.setItem(`time_${currentUser.id}`, JSON.stringify(notificationTime));
    }, [notificationTime, currentUser]);

    useEffect(() => {
        if (!currentUser) return;
        const todayKey = formatDate(new Date());
        const yesterday = new Date();
        yesterday.setDate(yesterday.getDate() - 1);
        const yesterdayKey = formatDate(yesterday);

        if (messages[yesterdayKey]?.toTomorrow && !messages[todayKey]?.fromYesterday) {
            showToast("ì–´ì œì˜ ë‚˜ë¡œë¶€í„° í¸ì§€ê°€ ë„ì°©í–ˆì–´ìš”!");
            setMessages(prev => ({
                ...prev,
                [todayKey]: { ...prev[todayKey], fromYesterday: messages[yesterdayKey].toTomorrow }
            }));
        }
    }, [messages, currentUser]);
    
    useEffect(() => {
        const todayKey = formatDate(currentDate);
        setMessageToSend(messages[todayKey]?.toTomorrow || '');
    }, [currentDate, messages]);

    const handleSaveMessage = () => {
        if (!messageToSend.trim()) return;
        const todayKey = formatDate(currentDate);
        const tomorrow = new Date(currentDate);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const tomorrowKey = formatDate(tomorrow);

        setMessages(prev => ({
            ...prev,
            [todayKey]: { ...prev[todayKey], toTomorrow: messageToSend },
            [tomorrowKey]: { ...prev[tomorrowKey], fromYesterday: messageToSend }
        }));

        showToast("í¸ì§€ê°€ ì•ˆì „í•˜ê²Œ ë¶€ì³ì¡ŒìŠµë‹ˆë‹¤.");
    };

    const handleLoginSuccess = (user) => {
        setCurrentUser(user);
        localStorage.setItem('currentUser', JSON.stringify(user));
        showToast("í™˜ì˜í•©ë‹ˆë‹¤!");
    };

    const handleLogout = () => {
        setCurrentUser(null);
        localStorage.removeItem('currentUser');
        setActiveTab('letter');
    };

    if (!currentUser) {
        return (
            <div className="h-full w-full overflow-hidden">
                <Toast isVisible={toast.isVisible} message={toast.message} />
                <AuthScreen onLoginSuccess={handleLoginSuccess} />
            </div>
        );
    }

    const todayKey = formatDate(currentDate);
    const isToday = todayKey === formatDate(new Date());
    const isSaved = !!messages[todayKey]?.toTomorrow;
    const messageFromYesterday = messages[todayKey]?.fromYesterday || '';
    const messagesCount = Object.keys(messages).filter(k => messages[k].toTomorrow).length;
    
    return (
        <div className="flex flex-col h-[100dvh] w-full max-w-md mx-auto relative px-6 overflow-hidden">
            <Toast isVisible={toast.isVisible} message={toast.message} />
            
            <div className="flex-1 overflow-hidden">
                {activeTab === 'letter' && (
                    <LetterTab 
                        currentDate={currentDate}
                        setCurrentDate={setCurrentDate}
                        isToday={isToday}
                        isSaved={isSaved}
                        messageFromYesterday={messageFromYesterday}
                        prompt={prompt}
                        messageToSend={messageToSend}
                        setMessageToSend={setMessageToSend}
                        setIsTimePickerOpen={setIsTimePickerOpen}
                        notificationTime={notificationTime}
                        handleSaveMessage={handleSaveMessage}
                    />
                )}
                {activeTab === 'board' && <BoardTab />}
                {activeTab === 'profile' && (
                    <ProfileTab 
                        profile={profile} 
                        setProfile={setProfile} 
                        onLogout={handleLogout}
                        messagesCount={messagesCount}
                        userEmail={currentUser.email}
                    />
                )}
            </div>

            <nav className="tab-bar">
                <button 
                    onClick={() => setActiveTab('letter')}
                    className={`flex flex-col items-center justify-center w-20 h-full transition-all duration-300 ${activeTab === 'letter' ? 'scale-110' : 'opacity-40 grayscale'}`}
                >
                    <span className="text-3xl mb-1">âœ‰ï¸</span>
                    <span className={`text-[10px] font-bold ${activeTab === 'letter' ? 'text-teal-600' : 'text-gray-400'}`}>í¸ì§€</span>
                </button>
                <button 
                    onClick={() => setActiveTab('board')}
                    className={`flex flex-col items-center justify-center w-20 h-full transition-all duration-300 ${activeTab === 'board' ? 'scale-110' : 'opacity-40 grayscale'}`}
                >
                    <span className="text-3xl mb-1">ğŸ“‹</span>
                    <span className={`text-[10px] font-bold ${activeTab === 'board' ? 'text-teal-600' : 'text-gray-400'}`}>ê²Œì‹œíŒ</span>
                </button>
                <button 
                    onClick={() => setActiveTab('profile')}
                    className={`flex flex-col items-center justify-center w-20 h-full transition-all duration-300 ${activeTab === 'profile' ? 'scale-110' : 'opacity-40 grayscale'}`}
                >
                    <span className="text-3xl mb-1">ğŸ‘¤</span>
                    <span className={`text-[10px] font-bold ${activeTab === 'profile' ? 'text-teal-600' : 'text-gray-400'}`}>í”„ë¡œí•„</span>
                </button>
            </nav>

            {/* TimePicker Modal */}
            <div className={`fixed inset-0 bg-black/50 backdrop-blur-sm flex justify-center items-end z-[100] p-4 transition-opacity duration-300 ${isTimePickerOpen ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>
                {isTimePickerOpen && (
                    <div className="bg-white unified-round p-6 w-full max-w-md shadow-2xl animate-in slide-in-from-bottom duration-300 mb-safe">
                        <h3 className="text-lg font-bold text-gray-800 mb-6 text-center">ì „ì†¡ ì‹œê°„ ì„¤ì •</h3>
                        <div className="flex justify-center items-center space-x-4 mb-8">
                            <div className="flex flex-col items-center">
                                <select value={notificationTime.hour} onChange={e => setNotificationTime({ ...notificationTime, hour: parseInt(e.target.value) })} className="bg-white border border-gray-200 unified-round px-5 py-3 text-xl font-bold text-gray-800 appearance-none text-center focus:ring-2 focus:ring-teal-400 shadow-sm">
                                    {Array.from({ length: 24 }, (_, i) => <option key={i} value={i}>{String(i).padStart(2, '0')}ì‹œ</option>)}
                                </select>
                            </div>
                            <span className="text-2xl font-bold text-gray-300">:</span>
                            <div className="flex flex-col items-center">
                                <select value={notificationTime.minute} onChange={e => setNotificationTime({ ...notificationTime, minute: parseInt(e.target.value) })} className="bg-white border border-gray-200 unified-round px-5 py-3 text-xl font-bold text-gray-800 appearance-none text-center focus:ring-2 focus:ring-teal-400 shadow-sm">
                                    {Array.from({ length: 60 }, (_, i) => <option key={i} value={i}>{String(i).padStart(2, '0')}ë¶„</option>)}
                                </select>
                            </div>
                        </div>
                        <button
                            onClick={() => setIsTimePickerOpen(false)}
                            className="w-full bg-teal-500 text-white font-bold py-4 unified-round hover:bg-teal-600 active:scale-95 transition-all shadow-md shadow-teal-50"
                        >
                            ì„¤ì • ì™„ë£Œ
                        </button>
                    </div>
                )}
            </div>
        </div>
    );
}

const rootElement = document.getElementById('root');
if (rootElement) {
  const root = ReactDOM.createRoot(rootElement);
  root.render(<React.StrictMode><App /></React.StrictMode>);
}
    </script>
  <script type="module" src="/index.tsx"></script>
</body>
</html>
